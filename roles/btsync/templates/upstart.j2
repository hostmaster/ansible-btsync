# btsync - P2P file synchronization service 
#
#

description "BitTorrent Sync"
 
start on filesystem or runlevel [2345]
stop on runlevel [!2345]

setuid khomyi
setgid khomyi

pre-start script
    test -x /opt/btsync/btsync || { stop; exit 0; }
    test -f /home/khomyi/.btsync.conf || { stop; exit 0; }
end script

respawn
respawn limit 5 20

script
    exec /opt/btsync/btsync --nodaemon --config /home/khomyi/.btsync.conf
end script
 
pre-stop script
    kill $(cat /home/khomyi/.sync/btsync.pid)
end script
